2024-12-07 16:58:36,865 - INFO - Training cub_test_seed2 with the following settings:
2024-12-07 16:58:36,865 - INFO - Command-line arguments: output_dir=exp
 experiment_name=cub_test_seed2
 seed=2
 evaluate=False
 dataset_name=cub
 backbone_name=ViT-B/16
 cub_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/CUB
 cub_retrieved_text_path=retrieved_text/cub_retrieved_text.npy
 flowers_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 flowers_retrieved_text_path=retrieved_text/flowers_retrieved_text.npy
 scars_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 scars_retrieved_text_path=retrieved_text/scars_retrieved_text.npy
 pets_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 pets_retrieved_text_path=retrieved_text/pets_retrieved_text.npy
 cifar10_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar10
 cifar10_retrieved_text_path=retrieved_text/cifar10_retrieved_text.npy
 cifar100_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar100
 cifar100_retrieved_text_path=retrieved_text/cifar100_retrieved_text.npy
 imagenet_root=/home/fandral/Nan/NCD_dataset
 imagenet_retrieved_text_path=retrieved_text/imagenet100_retrieved_text.npy
 osr_split_dir=data/ssb_splits
 epochs=200
 base_lr=0.0005
 classifier_lr=0.1
 momentum=0.9
 weight_decay=0.0001
 num_workers=8
 batch_size=128
 prop_train_labels=0.5
 use_ssb_splits=True
 transform=imagenet
 n_views=2
 selecting_ratio=0.6
 lambda_loss=0.2
 warm_up_epochs=10
 class_aligning_epochs=5
 num_attributes=2
 num_tags=3
 tau_s=0.1
 tau_u=0.05
 tau_t_start=0.035
 tau_t_end=0.02
 warmup_teacher_temp_epochs=30
 memax_weight=2
 image_size=224
 train_classes=[150, 70, 34, 178, 199, 131, 129, 147, 134, 11, 26, 93, 95, 121, 123, 99, 149, 167, 18, 31, 69, 198, 116, 158, 126, 17, 5, 179, 111, 163, 184, 81, 174, 42, 53, 89, 77, 55, 23, 48, 43, 44, 56, 28, 193, 143, 0, 176, 84, 15, 38, 154, 141, 190, 172, 124, 189, 19, 80, 157, 12, 9, 79, 30, 94, 67, 197, 97, 168, 137, 119, 76, 98, 88, 40, 106, 171, 87, 166, 186, 27, 51, 144, 135, 161, 64, 177, 7, 146, 61, 50, 162, 133, 82, 39, 74, 72, 91, 196, 136]
 unlabeled_classes=[29, 110, 3, 8, 13, 58, 142, 25, 145, 63, 59, 65, 24, 140, 120, 32, 114, 107, 160, 130, 118, 101, 115, 128, 117, 71, 156, 112, 36, 122, 104, 102, 90, 125, 152, 195, 132, 83, 22, 192, 153, 175, 191, 155, 49, 194, 73, 66, 170, 151, 169, 96, 103, 37, 181, 127, 78, 21, 10, 164, 62, 2, 183, 85, 45, 60, 92, 185, 20, 159, 173, 148, 1, 57, 113, 165, 52, 109, 14, 4, 180, 6, 182, 68, 33, 108, 46, 35, 75, 188, 187, 100, 47, 105, 41, 86, 16, 54, 139, 138]
 num_labeled_classes=100
 num_unlabeled_classes=100
 log_path=exp/cub_test_seed2-2024-12-07-16-58/logs/log.txt
 model_path=exp/cub_test_seed2-2024-12-07-16-58/models/model.pth
 device=cuda
2024-12-07 16:58:36,869 - INFO - Loading CLIP (backbone: ViT-B/16)
2024-12-07 16:58:39,418 - INFO - Building custom CLIP
2024-12-07 16:58:40,674 - INFO - Turning off gradients in both the image and the text encoder
2024-12-07 16:58:40,676 - INFO - Parameters that require gradients: ['model.text_projection', 'model.visual.proj', 'model.visual.transformer.resblocks.11.attn.in_proj_weight', 'model.visual.transformer.resblocks.11.attn.in_proj_bias', 'model.visual.transformer.resblocks.11.attn.out_proj.weight', 'model.visual.transformer.resblocks.11.attn.out_proj.bias', 'model.visual.transformer.resblocks.11.ln_1.weight', 'model.visual.transformer.resblocks.11.ln_1.bias', 'model.visual.transformer.resblocks.11.mlp.c_fc.weight', 'model.visual.transformer.resblocks.11.mlp.c_fc.bias', 'model.visual.transformer.resblocks.11.mlp.c_proj.weight', 'model.visual.transformer.resblocks.11.mlp.c_proj.bias', 'model.visual.transformer.resblocks.11.ln_2.weight', 'model.visual.transformer.resblocks.11.ln_2.bias', 'model.transformer.resblocks.11.attn.in_proj_weight', 'model.transformer.resblocks.11.attn.in_proj_bias', 'model.transformer.resblocks.11.attn.out_proj.weight', 'model.transformer.resblocks.11.attn.out_proj.bias', 'model.transformer.resblocks.11.ln_1.weight', 'model.transformer.resblocks.11.ln_1.bias', 'model.transformer.resblocks.11.mlp.c_fc.weight', 'model.transformer.resblocks.11.mlp.c_fc.bias', 'model.transformer.resblocks.11.mlp.c_proj.weight', 'model.transformer.resblocks.11.mlp.c_proj.bias', 'model.transformer.resblocks.11.ln_2.weight', 'model.transformer.resblocks.11.ln_2.bias', 'image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 16:58:43,856 - INFO - len of train dataset: 5994
2024-12-07 16:58:43,856 - INFO - len of test dataset: 4496
2024-12-07 16:58:43,861 - INFO - Parameters in classifier with big lr: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 16:58:43,862 - INFO - Selecting 13 high-confidence samples for co-teaching.
2024-12-07 16:59:06,199 - INFO - Before Train Accuracies: All 0.1054 | Old 0.0287 | New 0.1438
2024-12-07 16:59:06,199 - INFO - Before Train Accuracies: All 0.0331 | Old 0.0180 | New 0.0407
2024-12-07 16:59:49,806 - INFO - Epoch 1/200, Total Loss: 12.1099, Base Loss: 10.1238, Con Loss: 1.9862, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:59:49,806 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 16:59:49,806 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:00:05,471 - INFO - Text classifier Epoch 0 Train Accuracies: All 0.3350 | Old 0.2028 | New 0.4011
2024-12-07 17:00:05,472 - INFO - Image classifier Epoch 0 Train Accuracies: All 0.1495 | Old 0.1161 | New 0.1662
2024-12-07 17:00:21,094 - INFO - Weighted Accuracies: All 0.2378 | Old 0.1975 | New 0.2579
2024-12-07 17:00:21,715 - INFO - Saved model!
2024-12-07 17:01:02,598 - INFO - Epoch 2/200, Total Loss: 10.7513, Base Loss: 8.8734, Con Loss: 1.8779, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:01:02,598 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 17:01:02,598 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:01:18,048 - INFO - Text classifier Epoch 1 Train Accuracies: All 0.3601 | Old 0.2442 | New 0.4181
2024-12-07 17:01:18,048 - INFO - Image classifier Epoch 1 Train Accuracies: All 0.2117 | Old 0.1721 | New 0.2316
2024-12-07 17:01:33,641 - INFO - Weighted Accuracies: All 0.3376 | Old 0.2829 | New 0.3650
2024-12-07 17:01:34,401 - INFO - Saved model!
2024-12-07 17:02:15,787 - INFO - Epoch 3/200, Total Loss: 8.8445, Base Loss: 7.0136, Con Loss: 1.8309, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:02:15,787 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 17:02:15,787 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:02:31,729 - INFO - Text classifier Epoch 2 Train Accuracies: All 0.4397 | Old 0.3516 | New 0.4838
2024-12-07 17:02:31,729 - INFO - Image classifier Epoch 2 Train Accuracies: All 0.2740 | Old 0.2728 | New 0.2746
2024-12-07 17:02:47,603 - INFO - Weighted Accuracies: All 0.4104 | Old 0.4009 | New 0.4151
2024-12-07 17:02:48,355 - INFO - Saved model!
2024-12-07 17:03:29,336 - INFO - Epoch 4/200, Total Loss: 7.5168, Base Loss: 5.7302, Con Loss: 1.7867, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:03:29,336 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 17:03:29,336 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:03:45,195 - INFO - Text classifier Epoch 3 Train Accuracies: All 0.4749 | Old 0.4556 | New 0.4845
2024-12-07 17:03:45,195 - INFO - Image classifier Epoch 3 Train Accuracies: All 0.3254 | Old 0.3903 | New 0.2930
2024-12-07 17:04:00,940 - INFO - Weighted Accuracies: All 0.4355 | Old 0.4216 | New 0.4424
2024-12-07 17:04:01,696 - INFO - Saved model!
2024-12-07 17:04:42,719 - INFO - Epoch 5/200, Total Loss: 6.8036, Base Loss: 5.0240, Con Loss: 1.7796, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:04:42,719 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 17:04:42,719 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:04:58,351 - INFO - Text classifier Epoch 4 Train Accuracies: All 0.5060 | Old 0.4310 | New 0.5435
2024-12-07 17:04:58,351 - INFO - Image classifier Epoch 4 Train Accuracies: All 0.3699 | Old 0.4276 | New 0.3410
2024-12-07 17:05:14,246 - INFO - Weighted Accuracies: All 0.4493 | Old 0.4603 | New 0.4438
2024-12-07 17:05:14,996 - INFO - Saved model!
2024-12-07 17:05:56,036 - INFO - Epoch 6/200, Total Loss: 6.3326, Base Loss: 4.5972, Con Loss: 1.7354, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:05:56,037 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 17:05:56,037 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:06:11,691 - INFO - Text classifier Epoch 5 Train Accuracies: All 0.5189 | Old 0.4450 | New 0.5559
2024-12-07 17:06:11,691 - INFO - Image classifier Epoch 5 Train Accuracies: All 0.3835 | Old 0.4977 | New 0.3263
2024-12-07 17:06:27,225 - INFO - Weighted Accuracies: All 0.4751 | Old 0.4556 | New 0.4848
2024-12-07 17:06:27,940 - INFO - Saved model!
2024-12-07 17:07:08,236 - INFO - Epoch 7/200, Total Loss: 5.9900, Base Loss: 4.2839, Con Loss: 1.7061, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:07:08,236 - INFO -    Param Group: classifier_head, Learning Rate: 0.0997
2024-12-07 17:07:08,236 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:07:23,849 - INFO - Text classifier Epoch 6 Train Accuracies: All 0.5276 | Old 0.4216 | New 0.5806
2024-12-07 17:07:23,849 - INFO - Image classifier Epoch 6 Train Accuracies: All 0.4068 | Old 0.5170 | New 0.3517
2024-12-07 17:07:39,485 - INFO - Weighted Accuracies: All 0.4860 | Old 0.4583 | New 0.4998
2024-12-07 17:07:40,186 - INFO - Saved model!
2024-12-07 17:08:20,327 - INFO - Epoch 8/200, Total Loss: 5.7242, Base Loss: 4.0552, Con Loss: 1.6689, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:08:20,327 - INFO -    Param Group: classifier_head, Learning Rate: 0.0996
2024-12-07 17:08:20,327 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:08:36,018 - INFO - Text classifier Epoch 7 Train Accuracies: All 0.5494 | Old 0.5003 | New 0.5739
2024-12-07 17:08:36,018 - INFO - Image classifier Epoch 7 Train Accuracies: All 0.4139 | Old 0.5157 | New 0.3630
2024-12-07 17:08:51,576 - INFO - Weighted Accuracies: All 0.4875 | Old 0.4576 | New 0.5025
2024-12-07 17:08:52,308 - INFO - Saved model!
2024-12-07 17:09:33,137 - INFO - Epoch 9/200, Total Loss: 5.5808, Base Loss: 3.9154, Con Loss: 1.6655, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:09:33,137 - INFO -    Param Group: classifier_head, Learning Rate: 0.0995
2024-12-07 17:09:33,137 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:09:48,910 - INFO - Text classifier Epoch 8 Train Accuracies: All 0.5547 | Old 0.5457 | New 0.5592
2024-12-07 17:09:48,910 - INFO - Image classifier Epoch 8 Train Accuracies: All 0.4250 | Old 0.5203 | New 0.3774
2024-12-07 17:10:04,663 - INFO - Weighted Accuracies: All 0.5011 | Old 0.4736 | New 0.5148
2024-12-07 17:10:05,392 - INFO - Saved model!
2024-12-07 17:10:46,135 - INFO - Epoch 10/200, Total Loss: 5.3650, Base Loss: 3.7324, Con Loss: 1.6325, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:10:46,135 - INFO -    Param Group: classifier_head, Learning Rate: 0.0994
2024-12-07 17:10:46,135 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:11:02,078 - INFO - Text classifier Epoch 9 Train Accuracies: All 0.5716 | Old 0.5831 | New 0.5659
2024-12-07 17:11:02,078 - INFO - Image classifier Epoch 9 Train Accuracies: All 0.4353 | Old 0.5804 | New 0.3627
2024-12-07 17:11:17,995 - INFO - Weighted Accuracies: All 0.4958 | Old 0.4790 | New 0.5042
2024-12-07 17:11:58,970 - INFO - Epoch 11/200, Total Loss: 5.3267, Base Loss: 3.6858, Con Loss: 1.6409, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 17:11:58,970 - INFO -    Param Group: classifier_head, Learning Rate: 0.0993
2024-12-07 17:11:58,970 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:12:14,692 - INFO - Text classifier Epoch 10 Train Accuracies: All 0.5874 | Old 0.5957 | New 0.5832
2024-12-07 17:12:14,692 - INFO - Image classifier Epoch 10 Train Accuracies: All 0.4404 | Old 0.5710 | New 0.3750
2024-12-07 17:12:30,406 - INFO - Weighted Accuracies: All 0.5071 | Old 0.4563 | New 0.5325
2024-12-07 17:12:31,119 - INFO - Saved model!
2024-12-07 17:12:46,742 - INFO - len of text selected samples: 2311
2024-12-07 17:13:27,480 - INFO - Epoch 12/200, Total Loss: 8.2670, Base Loss: 3.5646, Con Loss: 1.6070, Pseudo Loss Image: 3.0953, Pseudo Loss Text: 0.0000
2024-12-07 17:13:27,480 - INFO -    Param Group: classifier_head, Learning Rate: 0.0991
2024-12-07 17:13:27,480 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 17:13:42,995 - INFO - Text classifier Epoch 11 Train Accuracies: All 0.5959 | Old 0.6411 | New 0.5732
2024-12-07 17:13:42,995 - INFO - Image classifier Epoch 11 Train Accuracies: All 0.4677 | Old 0.6538 | New 0.3747
