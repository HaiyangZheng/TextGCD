2024-12-07 16:48:15,100 - INFO - Training cub_test_seed1 with the following settings:
2024-12-07 16:48:15,100 - INFO - Command-line arguments: output_dir=exp
 experiment_name=cub_test_seed1
 seed=1
 evaluate=False
 dataset_name=cub
 backbone_name=ViT-B/16
 cub_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/CUB
 cub_retrieved_text_path=retrieved_text/cub_retrieved_text.npy
 flowers_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 flowers_retrieved_text_path=retrieved_text/flowers_retrieved_text.npy
 scars_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 scars_retrieved_text_path=retrieved_text/scars_retrieved_text.npy
 pets_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 pets_retrieved_text_path=retrieved_text/pets_retrieved_text.npy
 cifar10_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar10
 cifar10_retrieved_text_path=retrieved_text/cifar10_retrieved_text.npy
 cifar100_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar100
 cifar100_retrieved_text_path=retrieved_text/cifar100_retrieved_text.npy
 imagenet_root=/home/fandral/Nan/NCD_dataset
 imagenet_retrieved_text_path=retrieved_text/imagenet100_retrieved_text.npy
 osr_split_dir=data/ssb_splits
 epochs=200
 base_lr=0.0005
 classifier_lr=0.1
 momentum=0.9
 weight_decay=0.0001
 num_workers=8
 batch_size=128
 prop_train_labels=0.5
 use_ssb_splits=True
 transform=imagenet
 n_views=2
 selecting_ratio=0.6
 lambda_loss=0.2
 warm_up_epochs=10
 class_aligning_epochs=5
 num_attributes=2
 num_tags=3
 tau_s=0.1
 tau_u=0.05
 tau_t_start=0.035
 tau_t_end=0.02
 warmup_teacher_temp_epochs=30
 memax_weight=2
 image_size=224
 train_classes=[150, 70, 34, 178, 199, 131, 129, 147, 134, 11, 26, 93, 95, 121, 123, 99, 149, 167, 18, 31, 69, 198, 116, 158, 126, 17, 5, 179, 111, 163, 184, 81, 174, 42, 53, 89, 77, 55, 23, 48, 43, 44, 56, 28, 193, 143, 0, 176, 84, 15, 38, 154, 141, 190, 172, 124, 189, 19, 80, 157, 12, 9, 79, 30, 94, 67, 197, 97, 168, 137, 119, 76, 98, 88, 40, 106, 171, 87, 166, 186, 27, 51, 144, 135, 161, 64, 177, 7, 146, 61, 50, 162, 133, 82, 39, 74, 72, 91, 196, 136]
 unlabeled_classes=[29, 110, 3, 8, 13, 58, 142, 25, 145, 63, 59, 65, 24, 140, 120, 32, 114, 107, 160, 130, 118, 101, 115, 128, 117, 71, 156, 112, 36, 122, 104, 102, 90, 125, 152, 195, 132, 83, 22, 192, 153, 175, 191, 155, 49, 194, 73, 66, 170, 151, 169, 96, 103, 37, 181, 127, 78, 21, 10, 164, 62, 2, 183, 85, 45, 60, 92, 185, 20, 159, 173, 148, 1, 57, 113, 165, 52, 109, 14, 4, 180, 6, 182, 68, 33, 108, 46, 35, 75, 188, 187, 100, 47, 105, 41, 86, 16, 54, 139, 138]
 num_labeled_classes=100
 num_unlabeled_classes=100
 log_path=exp/cub_test_seed1-2024-12-07-16-48/logs/log.txt
 model_path=exp/cub_test_seed1-2024-12-07-16-48/models/model.pth
 device=cuda
2024-12-07 16:48:15,104 - INFO - Loading CLIP (backbone: ViT-B/16)
2024-12-07 16:48:17,470 - INFO - Building custom CLIP
2024-12-07 16:48:18,543 - INFO - Turning off gradients in both the image and the text encoder
2024-12-07 16:48:18,544 - INFO - Parameters that require gradients: ['model.text_projection', 'model.visual.proj', 'model.visual.transformer.resblocks.11.attn.in_proj_weight', 'model.visual.transformer.resblocks.11.attn.in_proj_bias', 'model.visual.transformer.resblocks.11.attn.out_proj.weight', 'model.visual.transformer.resblocks.11.attn.out_proj.bias', 'model.visual.transformer.resblocks.11.ln_1.weight', 'model.visual.transformer.resblocks.11.ln_1.bias', 'model.visual.transformer.resblocks.11.mlp.c_fc.weight', 'model.visual.transformer.resblocks.11.mlp.c_fc.bias', 'model.visual.transformer.resblocks.11.mlp.c_proj.weight', 'model.visual.transformer.resblocks.11.mlp.c_proj.bias', 'model.visual.transformer.resblocks.11.ln_2.weight', 'model.visual.transformer.resblocks.11.ln_2.bias', 'model.transformer.resblocks.11.attn.in_proj_weight', 'model.transformer.resblocks.11.attn.in_proj_bias', 'model.transformer.resblocks.11.attn.out_proj.weight', 'model.transformer.resblocks.11.attn.out_proj.bias', 'model.transformer.resblocks.11.ln_1.weight', 'model.transformer.resblocks.11.ln_1.bias', 'model.transformer.resblocks.11.mlp.c_fc.weight', 'model.transformer.resblocks.11.mlp.c_fc.bias', 'model.transformer.resblocks.11.mlp.c_proj.weight', 'model.transformer.resblocks.11.mlp.c_proj.bias', 'model.transformer.resblocks.11.ln_2.weight', 'model.transformer.resblocks.11.ln_2.bias', 'image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 16:48:21,488 - INFO - len of train dataset: 5994
2024-12-07 16:48:21,488 - INFO - len of test dataset: 4496
2024-12-07 16:48:21,492 - INFO - Parameters in classifier with big lr: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 16:48:21,493 - INFO - Selecting 13 high-confidence samples for co-teaching.
2024-12-07 16:48:43,034 - INFO - Before Train Accuracies: All 0.1544 | Old 0.0434 | New 0.2099
2024-12-07 16:48:43,034 - INFO - Before Train Accuracies: All 0.0627 | Old 0.0080 | New 0.0901
2024-12-07 16:49:25,427 - INFO - Epoch 1/200, Total Loss: 12.0943, Base Loss: 10.1037, Con Loss: 1.9906, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:49:25,427 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 16:49:25,427 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:49:40,460 - INFO - Text classifier Epoch 0 Train Accuracies: All 0.3192 | Old 0.2342 | New 0.3617
2024-12-07 16:49:40,460 - INFO - Image classifier Epoch 0 Train Accuracies: All 0.1715 | Old 0.1121 | New 0.2012
2024-12-07 16:49:55,563 - INFO - Weighted Accuracies: All 0.2711 | Old 0.2161 | New 0.2986
2024-12-07 16:49:56,147 - INFO - Saved model!
2024-12-07 16:50:35,680 - INFO - Epoch 2/200, Total Loss: 10.6468, Base Loss: 8.7979, Con Loss: 1.8490, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:50:35,680 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 16:50:35,680 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:50:50,856 - INFO - Text classifier Epoch 1 Train Accuracies: All 0.3681 | Old 0.2862 | New 0.4091
2024-12-07 16:50:50,856 - INFO - Image classifier Epoch 1 Train Accuracies: All 0.2173 | Old 0.1694 | New 0.2412
2024-12-07 16:51:05,683 - INFO - Weighted Accuracies: All 0.3292 | Old 0.2842 | New 0.3517
2024-12-07 16:51:06,338 - INFO - Saved model!
2024-12-07 16:51:46,032 - INFO - Epoch 3/200, Total Loss: 8.6839, Base Loss: 6.8532, Con Loss: 1.8307, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:51:46,032 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 16:51:46,032 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:52:00,911 - INFO - Text classifier Epoch 2 Train Accuracies: All 0.4257 | Old 0.3923 | New 0.4424
2024-12-07 16:52:00,911 - INFO - Image classifier Epoch 2 Train Accuracies: All 0.2809 | Old 0.2875 | New 0.2776
2024-12-07 16:52:16,050 - INFO - Weighted Accuracies: All 0.3886 | Old 0.3816 | New 0.3921
2024-12-07 16:52:16,712 - INFO - Saved model!
2024-12-07 16:52:56,865 - INFO - Epoch 4/200, Total Loss: 7.3808, Base Loss: 5.5960, Con Loss: 1.7848, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:52:56,865 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 16:52:56,865 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:53:11,996 - INFO - Text classifier Epoch 3 Train Accuracies: All 0.4733 | Old 0.4390 | New 0.4905
2024-12-07 16:53:11,997 - INFO - Image classifier Epoch 3 Train Accuracies: All 0.3265 | Old 0.3829 | New 0.2983
2024-12-07 16:53:27,161 - INFO - Weighted Accuracies: All 0.4286 | Old 0.4910 | New 0.3974
2024-12-07 16:53:27,827 - INFO - Saved model!
2024-12-07 16:54:08,013 - INFO - Epoch 5/200, Total Loss: 6.7359, Base Loss: 4.9564, Con Loss: 1.7795, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:54:08,013 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 16:54:08,013 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:54:23,088 - INFO - Text classifier Epoch 4 Train Accuracies: All 0.5102 | Old 0.4636 | New 0.5335
2024-12-07 16:54:23,088 - INFO - Image classifier Epoch 4 Train Accuracies: All 0.3603 | Old 0.3916 | New 0.3447
2024-12-07 16:54:38,137 - INFO - Weighted Accuracies: All 0.4542 | Old 0.4203 | New 0.4711
2024-12-07 16:54:38,802 - INFO - Saved model!
2024-12-07 16:55:18,782 - INFO - Epoch 6/200, Total Loss: 6.2695, Base Loss: 4.5224, Con Loss: 1.7471, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 16:55:18,783 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 16:55:18,783 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 16:55:33,849 - INFO - Text classifier Epoch 5 Train Accuracies: All 0.5340 | Old 0.4943 | New 0.5539
2024-12-07 16:55:33,849 - INFO - Image classifier Epoch 5 Train Accuracies: All 0.3746 | Old 0.4216 | New 0.3510
2024-12-07 16:55:48,967 - INFO - Weighted Accuracies: All 0.4633 | Old 0.4403 | New 0.4748
2024-12-07 16:55:49,625 - INFO - Saved model!
