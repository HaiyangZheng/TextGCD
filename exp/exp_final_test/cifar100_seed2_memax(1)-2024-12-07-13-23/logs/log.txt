2024-12-07 13:23:15,290 - INFO - Training cifar100_seed2_memax(1) with the following settings:
2024-12-07 13:23:15,292 - INFO - Command-line arguments: output_dir=exp_final_test
 experiment_name=cifar100_seed2_memax(1)
 seed=2
 evaluate=False
 dataset_name=cifar100
 backbone_name=ViT-B/16
 cub_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/CUB
 cub_retrieved_text_path=retrieved_text/cub_retrieved_text.npy
 flowers_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 flowers_retrieved_text_path=retrieved_text/flowers_retrieved_text.npy
 scars_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 scars_retrieved_text_path=retrieved_text/scars_retrieved_text.npy
 pets_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 pets_retrieved_text_path=retrieved_text/pets_retrieved_text.npy
 cifar10_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar10
 cifar10_retrieved_text_path=retrieved_text/cifar10_retrieved_text.npy
 cifar100_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar100
 cifar100_retrieved_text_path=retrieved_text/cifar100_retrieved_text.npy
 imagenet_root=/home/fandral/Nan/NCD_dataset
 imagenet_retrieved_text_path=retrieved_text/imagenet100_retrieved_text.npy
 osr_split_dir=data/ssb_splits
 epochs=200
 base_lr=0.0005
 classifier_lr=0.1
 momentum=0.9
 weight_decay=0.0001
 num_workers=8
 batch_size=128
 prop_train_labels=0.5
 use_ssb_splits=True
 transform=imagenet
 n_views=2
 selecting_ratio=0.6
 lambda_loss=0.2
 warm_up_epochs=10
 class_aligning_epochs=5
 num_attributes=2
 num_tags=3
 tau_s=0.1
 tau_u=0.05
 tau_t_start=0.035
 tau_t_end=0.02
 warmup_teacher_temp_epochs=30
 memax_weight=1.0
 image_size=224
 train_classes=range(0, 80)
 unlabeled_classes=range(80, 100)
 num_labeled_classes=80
 num_unlabeled_classes=20
 log_path=exp_final_test/cifar100_seed2_memax(1)-2024-12-07-13-23/logs/log.txt
 model_path=exp_final_test/cifar100_seed2_memax(1)-2024-12-07-13-23/models/model.pth
 device=cuda
2024-12-07 13:23:15,307 - INFO - Loading CLIP (backbone: ViT-B/16)
2024-12-07 13:23:17,745 - INFO - Building custom CLIP
2024-12-07 13:23:18,894 - INFO - Turning off gradients in both the image and the text encoder
2024-12-07 13:23:18,896 - INFO - Parameters that require gradients: ['model.text_projection', 'model.visual.proj', 'model.visual.transformer.resblocks.11.attn.in_proj_weight', 'model.visual.transformer.resblocks.11.attn.in_proj_bias', 'model.visual.transformer.resblocks.11.attn.out_proj.weight', 'model.visual.transformer.resblocks.11.attn.out_proj.bias', 'model.visual.transformer.resblocks.11.ln_1.weight', 'model.visual.transformer.resblocks.11.ln_1.bias', 'model.visual.transformer.resblocks.11.mlp.c_fc.weight', 'model.visual.transformer.resblocks.11.mlp.c_fc.bias', 'model.visual.transformer.resblocks.11.mlp.c_proj.weight', 'model.visual.transformer.resblocks.11.mlp.c_proj.bias', 'model.visual.transformer.resblocks.11.ln_2.weight', 'model.visual.transformer.resblocks.11.ln_2.bias', 'model.transformer.resblocks.11.attn.in_proj_weight', 'model.transformer.resblocks.11.attn.in_proj_bias', 'model.transformer.resblocks.11.attn.out_proj.weight', 'model.transformer.resblocks.11.attn.out_proj.bias', 'model.transformer.resblocks.11.ln_1.weight', 'model.transformer.resblocks.11.ln_1.bias', 'model.transformer.resblocks.11.mlp.c_fc.weight', 'model.transformer.resblocks.11.mlp.c_fc.bias', 'model.transformer.resblocks.11.mlp.c_proj.weight', 'model.transformer.resblocks.11.mlp.c_proj.bias', 'model.transformer.resblocks.11.ln_2.weight', 'model.transformer.resblocks.11.ln_2.bias', 'image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 13:23:24,278 - INFO - len of train dataset: 50000
2024-12-07 13:23:24,278 - INFO - len of test dataset: 30000
2024-12-07 13:23:24,287 - INFO - Parameters in classifier with big lr: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-07 13:23:24,288 - INFO - Selecting 180 high-confidence samples for co-teaching.
2024-12-07 13:24:51,193 - INFO - Before Train Accuracies: All 0.1199 | Old 0.0471 | New 0.2655
2024-12-07 13:24:51,194 - INFO - Before Train Accuracies: All 0.0738 | Old 0.0362 | New 0.1490
2024-12-07 13:30:03,097 - INFO - Epoch 1/200, Total Loss: 6.1347, Base Loss: 4.4928, Con Loss: 1.6418, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 13:30:03,097 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 13:30:03,097 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 13:31:20,985 - INFO - Text classifier Epoch 0 Train Accuracies: All 0.6761 | Old 0.6831 | New 0.6623
2024-12-07 13:31:20,985 - INFO - Image classifier Epoch 0 Train Accuracies: All 0.5587 | Old 0.6440 | New 0.3880
2024-12-07 13:32:38,936 - INFO - Weighted Accuracies: All 0.6513 | Old 0.7059 | New 0.5421
2024-12-07 13:32:39,568 - INFO - Saved model!
2024-12-07 13:37:49,483 - INFO - Epoch 2/200, Total Loss: 3.6370, Base Loss: 2.1108, Con Loss: 1.5262, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 13:37:49,483 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-07 13:37:49,483 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 13:39:07,861 - INFO - Text classifier Epoch 1 Train Accuracies: All 0.7252 | Old 0.7526 | New 0.6704
2024-12-07 13:39:07,861 - INFO - Image classifier Epoch 1 Train Accuracies: All 0.6242 | Old 0.6974 | New 0.4779
2024-12-07 13:40:25,710 - INFO - Weighted Accuracies: All 0.6587 | Old 0.7605 | New 0.4552
2024-12-07 13:40:26,391 - INFO - Saved model!
2024-12-07 13:45:36,001 - INFO - Epoch 3/200, Total Loss: 3.2765, Base Loss: 1.8255, Con Loss: 1.4509, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 13:45:36,001 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 13:45:36,001 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 13:46:53,860 - INFO - Text classifier Epoch 2 Train Accuracies: All 0.7431 | Old 0.7696 | New 0.6902
2024-12-07 13:46:53,860 - INFO - Image classifier Epoch 2 Train Accuracies: All 0.6463 | Old 0.7180 | New 0.5029
2024-12-07 13:48:12,221 - INFO - Weighted Accuracies: All 0.6641 | Old 0.7606 | New 0.4710
2024-12-07 13:48:12,901 - INFO - Saved model!
2024-12-07 13:53:22,457 - INFO - Epoch 4/200, Total Loss: 3.0880, Base Loss: 1.6841, Con Loss: 1.4039, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 13:53:22,457 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-07 13:53:22,457 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 13:54:40,612 - INFO - Text classifier Epoch 3 Train Accuracies: All 0.7574 | Old 0.7765 | New 0.7192
2024-12-07 13:54:40,612 - INFO - Image classifier Epoch 3 Train Accuracies: All 0.6564 | Old 0.7367 | New 0.4958
2024-12-07 13:55:58,485 - INFO - Weighted Accuracies: All 0.6624 | Old 0.7869 | New 0.4134
2024-12-07 14:01:09,672 - INFO - Epoch 5/200, Total Loss: 2.9752, Base Loss: 1.6040, Con Loss: 1.3712, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:01:09,672 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 14:01:09,672 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:02:28,355 - INFO - Text classifier Epoch 4 Train Accuracies: All 0.7599 | Old 0.7862 | New 0.7074
2024-12-07 14:02:28,355 - INFO - Image classifier Epoch 4 Train Accuracies: All 0.6589 | Old 0.7512 | New 0.4741
2024-12-07 14:03:47,087 - INFO - Weighted Accuracies: All 0.6590 | Old 0.7970 | New 0.3829
2024-12-07 14:08:58,377 - INFO - Epoch 6/200, Total Loss: 2.9011, Base Loss: 1.5525, Con Loss: 1.3486, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:08:58,377 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-07 14:08:58,377 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:10:16,510 - INFO - Text classifier Epoch 5 Train Accuracies: All 0.7625 | Old 0.7846 | New 0.7182
2024-12-07 14:10:16,510 - INFO - Image classifier Epoch 5 Train Accuracies: All 0.6732 | Old 0.7523 | New 0.5151
2024-12-07 14:11:34,887 - INFO - Weighted Accuracies: All 0.6612 | Old 0.7994 | New 0.3850
2024-12-07 14:16:44,264 - INFO - Epoch 7/200, Total Loss: 2.8376, Base Loss: 1.5130, Con Loss: 1.3246, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:16:44,264 - INFO -    Param Group: classifier_head, Learning Rate: 0.0997
2024-12-07 14:16:44,264 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:18:02,082 - INFO - Text classifier Epoch 6 Train Accuracies: All 0.7642 | Old 0.7864 | New 0.7197
2024-12-07 14:18:02,082 - INFO - Image classifier Epoch 6 Train Accuracies: All 0.6835 | Old 0.7510 | New 0.5486
2024-12-07 14:19:20,544 - INFO - Weighted Accuracies: All 0.6675 | Old 0.8116 | New 0.3793
2024-12-07 14:19:21,223 - INFO - Saved model!
2024-12-07 14:24:30,550 - INFO - Epoch 8/200, Total Loss: 2.7799, Base Loss: 1.4727, Con Loss: 1.3072, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:24:30,551 - INFO -    Param Group: classifier_head, Learning Rate: 0.0996
2024-12-07 14:24:30,551 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:25:48,490 - INFO - Text classifier Epoch 7 Train Accuracies: All 0.7650 | Old 0.7861 | New 0.7228
2024-12-07 14:25:48,490 - INFO - Image classifier Epoch 7 Train Accuracies: All 0.6898 | Old 0.7695 | New 0.5304
2024-12-07 14:27:06,854 - INFO - Weighted Accuracies: All 0.6708 | Old 0.7999 | New 0.4126
2024-12-07 14:27:07,528 - INFO - Saved model!
2024-12-07 14:32:16,901 - INFO - Epoch 9/200, Total Loss: 2.7450, Base Loss: 1.4504, Con Loss: 1.2946, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:32:16,901 - INFO -    Param Group: classifier_head, Learning Rate: 0.0995
2024-12-07 14:32:16,901 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:33:34,821 - INFO - Text classifier Epoch 8 Train Accuracies: All 0.7674 | Old 0.7873 | New 0.7278
2024-12-07 14:33:34,821 - INFO - Image classifier Epoch 8 Train Accuracies: All 0.6967 | Old 0.7593 | New 0.5713
2024-12-07 14:34:53,242 - INFO - Weighted Accuracies: All 0.6774 | Old 0.8046 | New 0.4229
2024-12-07 14:34:53,938 - INFO - Saved model!
2024-12-07 14:40:03,589 - INFO - Epoch 10/200, Total Loss: 2.7270, Base Loss: 1.4362, Con Loss: 1.2908, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:40:03,589 - INFO -    Param Group: classifier_head, Learning Rate: 0.0994
2024-12-07 14:40:03,589 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:41:22,016 - INFO - Text classifier Epoch 9 Train Accuracies: All 0.7785 | Old 0.7881 | New 0.7593
2024-12-07 14:41:22,016 - INFO - Image classifier Epoch 9 Train Accuracies: All 0.7038 | Old 0.7917 | New 0.5279
2024-12-07 14:42:40,016 - INFO - Weighted Accuracies: All 0.6828 | Old 0.7968 | New 0.4547
2024-12-07 14:42:40,694 - INFO - Saved model!
2024-12-07 14:47:50,759 - INFO - Epoch 11/200, Total Loss: 2.6633, Base Loss: 1.3989, Con Loss: 1.2645, Pseudo Loss Image: 0.0000, Pseudo Loss Text: 0.0000
2024-12-07 14:47:50,759 - INFO -    Param Group: classifier_head, Learning Rate: 0.0993
2024-12-07 14:47:50,759 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-07 14:49:08,681 - INFO - Text classifier Epoch 10 Train Accuracies: All 0.7789 | Old 0.7907 | New 0.7552
2024-12-07 14:49:08,681 - INFO - Image classifier Epoch 10 Train Accuracies: All 0.7164 | Old 0.7916 | New 0.5659
2024-12-07 14:50:26,641 - INFO - Weighted Accuracies: All 0.6803 | Old 0.7943 | New 0.4525
2024-12-07 14:51:44,590 - INFO - len of text selected samples: 17977
