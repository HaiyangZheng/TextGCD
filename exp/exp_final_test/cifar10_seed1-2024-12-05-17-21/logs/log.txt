2024-12-05 17:21:13,216 - INFO - Training cifar10_seed1 with the following settings:
2024-12-05 17:21:13,216 - INFO - Command-line arguments: output_dir=exp_final_test
 experiment_name=cifar10_seed1
 seed=1
 evaluate=False
 dataset_name=cifar10
 backbone_name=ViT-B/16
 cub_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/CUB
 cub_retrieved_text_path=retrieved_text/cub_retrieved_text.npy
 flowers_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 flowers_retrieved_text_path=retrieved_text/flowers_retrieved_text.npy
 scars_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 scars_retrieved_text_path=retrieved_text/scars_retrieved_text.npy
 pets_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets
 pets_retrieved_text_path=retrieved_text/pets_retrieved_text.npy
 cifar10_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar10
 cifar10_retrieved_text_path=retrieved_text/cifar10_retrieved_text.npy
 cifar100_root=/leonardo_work/IscrC_Fed-GCD/GCD_datasets/cifar100
 cifar100_retrieved_text_path=retrieved_text/cifar100_retrieved_text.npy
 imagenet_root=/home/fandral/Nan/NCD_dataset
 imagenet_retrieved_text_path=retrieved_text/imagenet100_retrieved_text.npy
 osr_split_dir=data/ssb_splits
 epochs=200
 base_lr=0.0005
 classifier_lr=0.1
 momentum=0.9
 weight_decay=0.0001
 num_workers=8
 batch_size=128
 prop_train_labels=0.5
 use_ssb_splits=True
 transform=imagenet
 n_views=2
 selecting_ratio=0.6
 lambda_loss=0.2
 warm_up_epochs=10
 class_aligning_epochs=5
 num_attributes=2
 num_tags=3
 tau_s=0.1
 tau_u=0.1
 tau_t_start=0.07
 tau_t_end=0.04
 warmup_teacher_temp_epochs=30
 memax_weight=2
 image_size=224
 train_classes=range(0, 5)
 unlabeled_classes=range(5, 10)
 num_labeled_classes=5
 num_unlabeled_classes=5
 log_path=exp_final_test/cifar10_seed1-2024-12-05-17-21/logs/log.txt
 model_path=exp_final_test/cifar10_seed1-2024-12-05-17-21/models/model.pth
 device=cuda
2024-12-05 17:21:13,230 - INFO - Loading CLIP (backbone: ViT-B/16)
2024-12-05 17:21:15,733 - INFO - Building custom CLIP
2024-12-05 17:21:16,894 - INFO - Turning off gradients in both the image and the text encoder
2024-12-05 17:21:16,896 - INFO - Parameters that require gradients: ['model.text_projection', 'model.visual.proj', 'model.visual.transformer.resblocks.11.attn.in_proj_weight', 'model.visual.transformer.resblocks.11.attn.in_proj_bias', 'model.visual.transformer.resblocks.11.attn.out_proj.weight', 'model.visual.transformer.resblocks.11.attn.out_proj.bias', 'model.visual.transformer.resblocks.11.ln_1.weight', 'model.visual.transformer.resblocks.11.ln_1.bias', 'model.visual.transformer.resblocks.11.mlp.c_fc.weight', 'model.visual.transformer.resblocks.11.mlp.c_fc.bias', 'model.visual.transformer.resblocks.11.mlp.c_proj.weight', 'model.visual.transformer.resblocks.11.mlp.c_proj.bias', 'model.visual.transformer.resblocks.11.ln_2.weight', 'model.visual.transformer.resblocks.11.ln_2.bias', 'model.transformer.resblocks.11.attn.in_proj_weight', 'model.transformer.resblocks.11.attn.in_proj_bias', 'model.transformer.resblocks.11.attn.out_proj.weight', 'model.transformer.resblocks.11.attn.out_proj.bias', 'model.transformer.resblocks.11.ln_1.weight', 'model.transformer.resblocks.11.ln_1.bias', 'model.transformer.resblocks.11.mlp.c_fc.weight', 'model.transformer.resblocks.11.mlp.c_fc.bias', 'model.transformer.resblocks.11.mlp.c_proj.weight', 'model.transformer.resblocks.11.mlp.c_proj.bias', 'model.transformer.resblocks.11.ln_2.weight', 'model.transformer.resblocks.11.ln_2.bias', 'image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-05 17:21:21,974 - INFO - len of train dataset: 50000
2024-12-05 17:21:21,975 - INFO - len of test dataset: 37500
2024-12-05 17:21:21,985 - INFO - Parameters in classifier with big lr: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2024-12-05 17:21:21,986 - INFO - Selecting 2250 high-confidence samples for co-teaching.
2024-12-05 17:23:06,557 - INFO - Before Train Accuracies: All 0.2354 | Old 0.0535 | New 0.3263
2024-12-05 17:23:06,557 - INFO - Before Train Accuracies: All 0.2351 | Old 0.1057 | New 0.2998
2024-12-05 17:28:18,803 - INFO - Epoch 1/200, Total Loss: 3.4364, Base Loss: 1.3863, Con Loss: 2.0501, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 17:28:18,803 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-05 17:28:18,803 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 17:29:56,722 - INFO - Text classifier Epoch 0 Train Accuracies: All 0.9728 | Old 0.9531 | New 0.9826
2024-12-05 17:29:56,722 - INFO - Image classifier Epoch 0 Train Accuracies: All 0.9469 | Old 0.9184 | New 0.9612
2024-12-05 17:31:34,803 - INFO - Weighted Accuracies: All 0.7523 | Old 0.9734 | New 0.6417
2024-12-05 17:31:35,426 - INFO - Saved model!
2024-12-05 17:36:46,365 - INFO - Epoch 2/200, Total Loss: 2.4916, Base Loss: 0.6115, Con Loss: 1.8801, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 17:36:46,365 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2024-12-05 17:36:46,365 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 17:38:23,979 - INFO - Text classifier Epoch 1 Train Accuracies: All 0.9705 | Old 0.9437 | New 0.9840
2024-12-05 17:38:23,979 - INFO - Image classifier Epoch 1 Train Accuracies: All 0.9518 | Old 0.9199 | New 0.9677
2024-12-05 17:40:01,959 - INFO - Weighted Accuracies: All 0.8039 | Old 0.9726 | New 0.7196
2024-12-05 17:40:02,666 - INFO - Saved model!
2024-12-05 17:45:13,357 - INFO - Epoch 3/200, Total Loss: 2.3702, Base Loss: 0.5645, Con Loss: 1.8057, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 17:45:13,357 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-05 17:45:13,357 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 17:46:51,613 - INFO - Text classifier Epoch 2 Train Accuracies: All 0.9731 | Old 0.9513 | New 0.9840
2024-12-05 17:46:51,613 - INFO - Image classifier Epoch 2 Train Accuracies: All 0.9545 | Old 0.9282 | New 0.9676
2024-12-05 17:48:29,420 - INFO - Weighted Accuracies: All 0.8035 | Old 0.9751 | New 0.7177
2024-12-05 17:53:40,950 - INFO - Epoch 4/200, Total Loss: 2.2748, Base Loss: 0.5347, Con Loss: 1.7401, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 17:53:40,950 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2024-12-05 17:53:40,950 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 17:55:19,137 - INFO - Text classifier Epoch 3 Train Accuracies: All 0.9715 | Old 0.9471 | New 0.9836
2024-12-05 17:55:19,137 - INFO - Image classifier Epoch 3 Train Accuracies: All 0.9536 | Old 0.9282 | New 0.9663
2024-12-05 17:56:56,928 - INFO - Weighted Accuracies: All 0.8052 | Old 0.9751 | New 0.7202
2024-12-05 17:56:57,646 - INFO - Saved model!
2024-12-05 18:02:09,235 - INFO - Epoch 5/200, Total Loss: 2.2244, Base Loss: 0.5244, Con Loss: 1.7000, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:02:09,235 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-05 18:02:09,235 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:03:47,071 - INFO - Text classifier Epoch 4 Train Accuracies: All 0.9718 | Old 0.9478 | New 0.9838
2024-12-05 18:03:47,071 - INFO - Image classifier Epoch 4 Train Accuracies: All 0.9529 | Old 0.9288 | New 0.9649
2024-12-05 18:05:25,097 - INFO - Weighted Accuracies: All 0.8119 | Old 0.9769 | New 0.7294
2024-12-05 18:05:25,812 - INFO - Saved model!
2024-12-05 18:10:37,084 - INFO - Epoch 6/200, Total Loss: 2.1658, Base Loss: 0.5065, Con Loss: 1.6592, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:10:37,085 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2024-12-05 18:10:37,085 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:12:15,232 - INFO - Text classifier Epoch 5 Train Accuracies: All 0.9712 | Old 0.9473 | New 0.9832
2024-12-05 18:12:15,233 - INFO - Image classifier Epoch 5 Train Accuracies: All 0.9604 | Old 0.9302 | New 0.9755
2024-12-05 18:13:53,230 - INFO - Weighted Accuracies: All 0.8328 | Old 0.9741 | New 0.7622
2024-12-05 18:13:53,936 - INFO - Saved model!
2024-12-05 18:19:06,051 - INFO - Epoch 7/200, Total Loss: 2.1354, Base Loss: 0.4982, Con Loss: 1.6372, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:19:06,052 - INFO -    Param Group: classifier_head, Learning Rate: 0.0997
2024-12-05 18:19:06,052 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:20:44,288 - INFO - Text classifier Epoch 6 Train Accuracies: All 0.9715 | Old 0.9454 | New 0.9846
2024-12-05 18:20:44,290 - INFO - Image classifier Epoch 6 Train Accuracies: All 0.9597 | Old 0.9418 | New 0.9686
2024-12-05 18:22:22,248 - INFO - Weighted Accuracies: All 0.8175 | Old 0.9765 | New 0.7380
2024-12-05 18:27:33,655 - INFO - Epoch 8/200, Total Loss: 2.0769, Base Loss: 0.4868, Con Loss: 1.5901, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:27:33,655 - INFO -    Param Group: classifier_head, Learning Rate: 0.0996
2024-12-05 18:27:33,655 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:29:11,613 - INFO - Text classifier Epoch 7 Train Accuracies: All 0.9718 | Old 0.9469 | New 0.9842
2024-12-05 18:29:11,613 - INFO - Image classifier Epoch 7 Train Accuracies: All 0.9591 | Old 0.9366 | New 0.9704
2024-12-05 18:30:49,726 - INFO - Weighted Accuracies: All 0.8192 | Old 0.9764 | New 0.7406
2024-12-05 18:36:02,024 - INFO - Epoch 9/200, Total Loss: 2.0610, Base Loss: 0.4856, Con Loss: 1.5754, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:36:02,026 - INFO -    Param Group: classifier_head, Learning Rate: 0.0995
2024-12-05 18:36:02,026 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:37:40,110 - INFO - Text classifier Epoch 8 Train Accuracies: All 0.9713 | Old 0.9476 | New 0.9832
2024-12-05 18:37:40,112 - INFO - Image classifier Epoch 8 Train Accuracies: All 0.9603 | Old 0.9329 | New 0.9740
2024-12-05 18:39:18,247 - INFO - Weighted Accuracies: All 0.8177 | Old 0.9762 | New 0.7384
2024-12-05 18:44:30,525 - INFO - Epoch 10/200, Total Loss: 2.0319, Base Loss: 0.4835, Con Loss: 1.5485, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:44:30,525 - INFO -    Param Group: classifier_head, Learning Rate: 0.0994
2024-12-05 18:44:30,525 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:46:08,519 - INFO - Text classifier Epoch 9 Train Accuracies: All 0.9697 | Old 0.9419 | New 0.9836
2024-12-05 18:46:08,519 - INFO - Image classifier Epoch 9 Train Accuracies: All 0.9614 | Old 0.9424 | New 0.9709
2024-12-05 18:47:46,719 - INFO - Weighted Accuracies: All 0.8244 | Old 0.9758 | New 0.7486
2024-12-05 18:52:58,580 - INFO - Epoch 11/200, Total Loss: 1.9883, Base Loss: 0.4666, Con Loss: 1.5217, Pseudo Loss Image: 0.0000, Pseudo Loss Image: 0.0000
2024-12-05 18:52:58,580 - INFO -    Param Group: classifier_head, Learning Rate: 0.0993
2024-12-05 18:52:58,581 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2024-12-05 18:54:36,316 - INFO - Text classifier Epoch 10 Train Accuracies: All 0.9718 | Old 0.9482 | New 0.9835
2024-12-05 18:54:36,316 - INFO - Image classifier Epoch 10 Train Accuracies: All 0.9606 | Old 0.9362 | New 0.9728
2024-12-05 18:56:14,067 - INFO - Weighted Accuracies: All 0.7998 | Old 0.9773 | New 0.7110
2024-12-05 18:57:52,169 - INFO - len of text selected samples: 22500
